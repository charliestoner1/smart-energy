<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Energy | Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="dashboard.css?v=3">
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <img src="images/NovaHouse.png" alt="NovaSense" style="height: 36px; width: auto;">
        <span class="logo-text">NovaSense</span>
      </div>
    </div>
    
    <div class="nav-section">
      <span class="nav-label">Main</span>
      <a href="#" class="nav-item active" id="navDashboard" onclick="switchView('dashboard')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="3" y="14" width="7" height="7" rx="1"/>
          <rect x="14" y="14" width="7" height="7" rx="1"/>
        </svg>
        Dashboard
      </a>
      <a href="#" class="nav-item" id="navAnalytics" onclick="switchView('analytics')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3v18h18"/>
          <path d="M18 9l-5 5-4-4-3 3"/>
        </svg>
        Analytics
      </a>
      <a href="#" class="nav-item" id="navDevices" onclick="switchView('devices')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
        </svg>
        Devices
      </a>
    </div>
    
    <div class="nav-section">
      <span class="nav-label">Settings</span>
      <a href="#" class="nav-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        Preferences
      </a>
      <a href="index.html" class="nav-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        Logout
      </a>
    </div>
    
    <div class="sidebar-footer">
      <div class="connection-status" id="connectionStatus">
        <span class="status-dot"></span>
        <span>Connecting...</span>
      </div>
    </div>
  </nav>
  
  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 id="viewTitle">Dashboard</h1>
        <p class="header-subtitle" id="viewSubtitle">Real-time energy monitoring</p>
      </div>
      <div class="header-right" id="headerControls">
        <!-- Mode Toggle Switch -->
        <div class="mode-toggle" id="modeToggle">
          <button class="mode-toggle-btn active" id="ecoModeBtn" onclick="setMode('eco')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/>
            </svg>
            <span>Eco</span>
          </button>
          <button class="mode-toggle-btn" id="manualModeBtn" onclick="setMode('manual')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
            <span>Manual</span>
          </button>
        </div>
      </div>
    </header>
    
    <!-- Mode Info Banner -->
    <div class="mode-info-banner eco" id="modeInfoBanner">
      <span class="mode-info-icon">üåø</span>
      <span class="mode-info-text" id="modeInfoText">Eco Mode: Automatic control based on electricity pricing and occupancy</span>
    </div>
    
    <!-- ========== DASHBOARD VIEW ========== -->
    <div class="view-container" id="dashboardView">
      <!-- Pricing Hero Card -->
      <section class="pricing-hero" id="pricingHero">
        <div class="pricing-main">
          <span class="pricing-label">Current Electricity Price</span>
          <div class="pricing-value">
            <span class="price-number" id="currentPrice">--</span>
            <span class="price-unit">¬¢/kWh</span>
          </div>
          <div class="pricing-tier" id="pricingTier">
            <span class="tier-badge">LOADING</span>
            <span class="tier-message" id="tierMessage">Fetching pricing data...</span>
          </div>
        </div>
        <div class="pricing-meta">
          <div class="meta-item">
            <span class="meta-label">24h Average</span>
            <span class="meta-value" id="avgPrice">--¬¢</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Today's Range</span>
            <span class="meta-value" id="priceRange">-- - --¬¢</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Recommended</span>
            <span class="meta-value" id="recommendation">--</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Projected Cost</span>
            <span class="meta-value highlight">$<span id="projectedCost">0.00</span></span>
          </div>
        </div>
      </section>
    
    <!-- Room Cards -->
    <section class="room-grid">
      <div class="room-card" id="roomA">
        <div class="room-header">
          <h3>Room A</h3>
          <span class="occupancy-badge" id="occupancyA">
            <span class="occupancy-dot"></span>
            Vacant
          </span>
        </div>
        <div class="thermostat-container">
          <div class="thermostat-dial" id="thermostatA">
            <svg viewBox="0 0 200 200" class="thermostat-ring">
              <!-- Background ring -->
              <circle cx="100" cy="100" r="85" fill="none" stroke="var(--bg-secondary)" stroke-width="12"/>
              <!-- Temperature arc - will be colored based on temp -->
              <circle cx="100" cy="100" r="85" fill="none" stroke="url(#tempGradientA)" stroke-width="12"
                      stroke-dasharray="534" stroke-dashoffset="267" stroke-linecap="round"
                      transform="rotate(-90 100 100)" class="temp-arc" id="tempArcA"/>
              <!-- Gradient definition -->
              <defs>
                <linearGradient id="tempGradientA" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#3b82f6"/>
                  <stop offset="50%" style="stop-color:#22c55e"/>
                  <stop offset="100%" style="stop-color:#f97316"/>
                </linearGradient>
              </defs>
            </svg>
            <div class="thermostat-center">
              <span class="thermostat-temp" id="tempA">--</span>
              <span class="thermostat-unit">¬∞C</span>
              <div class="thermostat-humidity">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="humidity-icon">
                  <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                </svg>
                <span id="humidityA">--%</span>
              </div>
            </div>
          </div>
        </div>
        <div class="room-controls" id="controlsRoomA">
          <div class="control-item">
            <span class="control-label">Fan</span>
            <button class="btn-toggle" id="fanABtn" onclick="toggleDevice('fanA')">
              <span class="toggle-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 12c-1.5-2.5-4-4-4-6.5a4 4 0 118 0c0 2.5-2.5 4-4 6.5z"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(72 12 12)"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(144 12 12)"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(216 12 12)"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(288 12 12)"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </span>
              <span class="toggle-label">OFF</span>
            </button>
          </div>
          <div class="control-item">
            <span class="control-label">Light</span>
            <button class="btn-toggle" id="lampABtn" onclick="toggleDevice('lampA')">
              <span class="toggle-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18h6M10 22h4M12 2v1M4.22 4.22l.71.71M1 12h1M4.22 19.78l.71-.71M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/>
                </svg>
              </span>
              <span class="toggle-label">OFF</span>
            </button>
          </div>
        </div>
        <!-- Eco Mode Overlay -->
        <div class="eco-overlay" id="ecoOverlayA">
          <div class="eco-overlay-content">
            <span class="eco-overlay-icon">üåø</span>
            <span class="eco-overlay-text">Auto Control Active</span>
          </div>
        </div>
      </div>
      
      <div class="room-card" id="roomB">
        <div class="room-header">
          <h3>Room B</h3>
          <span class="occupancy-badge" id="occupancyB">
            <span class="occupancy-dot"></span>
            Vacant
          </span>
        </div>
        <div class="thermostat-container">
          <div class="thermostat-dial" id="thermostatB">
            <svg viewBox="0 0 200 200" class="thermostat-ring">
              <!-- Background ring -->
              <circle cx="100" cy="100" r="85" fill="none" stroke="var(--bg-secondary)" stroke-width="12"/>
              <!-- Temperature arc - will be colored based on temp -->
              <circle cx="100" cy="100" r="85" fill="none" stroke="url(#tempGradientB)" stroke-width="12"
                      stroke-dasharray="534" stroke-dashoffset="267" stroke-linecap="round"
                      transform="rotate(-90 100 100)" class="temp-arc" id="tempArcB"/>
              <!-- Gradient definition -->
              <defs>
                <linearGradient id="tempGradientB" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#3b82f6"/>
                  <stop offset="50%" style="stop-color:#22c55e"/>
                  <stop offset="100%" style="stop-color:#f97316"/>
                </linearGradient>
              </defs>
            </svg>
            <div class="thermostat-center">
              <span class="thermostat-temp" id="tempB">--</span>
              <span class="thermostat-unit">¬∞C</span>
              <div class="thermostat-humidity">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="humidity-icon">
                  <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                </svg>
                <span id="humidityB">--%</span>
              </div>
            </div>
          </div>
        </div>
        <div class="room-controls" id="controlsRoomB">
          <div class="control-item">
            <span class="control-label">Fan</span>
            <button class="btn-toggle" id="fanBBtn" onclick="toggleDevice('fanB')">
              <span class="toggle-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 12c-1.5-2.5-4-4-4-6.5a4 4 0 118 0c0 2.5-2.5 4-4 6.5z"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(72 12 12)"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(144 12 12)"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(216 12 12)"/>
                  <path d="M12 12c2.5 1.5 4 4 6.5 4a4 4 0 11-8 0c0-2.5 2.5-4 1.5-4z" transform="rotate(288 12 12)"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </span>
              <span class="toggle-label">OFF</span>
            </button>
          </div>
          <div class="control-item">
            <span class="control-label">Light</span>
            <button class="btn-toggle" id="lampBBtn" onclick="toggleDevice('lampB')">
              <span class="toggle-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18h6M10 22h4M12 2v1M4.22 4.22l.71.71M1 12h1M4.22 19.78l.71-.71M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/>
                </svg>
              </span>
              <span class="toggle-label">OFF</span>
            </button>
          </div>
        </div>
        <!-- Eco Mode Overlay -->
        <div class="eco-overlay" id="ecoOverlayB">
          <div class="eco-overlay-content">
            <span class="eco-overlay-icon">üåø</span>
            <span class="eco-overlay-text">Auto Control Active</span>
          </div>
        </div>
      </div>
    </section>
      
      <!-- Alerts Section -->
      <section class="alerts-section">
        <div class="alerts-header">
          <h3>System Alerts</h3>
          <button class="btn-clear" onclick="clearAlerts()">Clear All</button>
        </div>
        <div class="alerts-list" id="alerts">
          <div class="alert-item info">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 16v-4M12 8h.01"/>
            </svg>
            <span>System initialized. Waiting for sensor data...</span>
            <span class="alert-time">Just now</span>
          </div>
        </div>
      </section>
    </div>
    
    <!-- ========== ANALYTICS VIEW ========== -->
    <div class="view-container hidden" id="analyticsView">
      <!-- Charts Grid -->
      <section class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">
            <h3>Power Consumption</h3>
            <span class="chart-live">‚óè LIVE</span>
          </div>
          <canvas id="powerChart"></canvas>
        </div>
        
        <div class="chart-card">
          <div class="chart-header">
            <h3>Temperature & Humidity</h3>
            <span class="chart-live">‚óè LIVE</span>
          </div>
          <canvas id="tempChart"></canvas>
        </div>
        
        <div class="chart-card full-width">
          <div class="chart-header">
            <h3>Electricity Pricing History</h3>
            <span class="chart-subtitle">Last 6 hours</span>
          </div>
          <canvas id="pricingChart"></canvas>
        </div>
      </section>
      
      <!-- Analytics Stats Cards -->
      <section class="analytics-stats">
        <div class="stat-card">
          <div class="stat-icon power">‚ö°</div>
          <div class="stat-content">
            <span class="stat-label">Total Energy Today</span>
            <span class="stat-value" id="totalEnergy">0.00 kWh</span>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon cost">üí∞</div>
          <div class="stat-content">
            <span class="stat-label">Estimated Cost Today</span>
            <span class="stat-value" id="totalCost">$0.00</span>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon savings">üåø</div>
          <div class="stat-content">
            <span class="stat-label">Eco Mode Savings</span>
            <span class="stat-value" id="ecoSavings">~15%</span>
          </div>
        </div>
    </div>
    
    <!-- ========== DEVICES VIEW (placeholder) ========== -->
    <div class="view-container hidden" id="devicesView">
      <div class="placeholder-content">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="placeholder-icon">
          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
        </svg>
        <h3>Coming Soon</h3>
        <p>Device configuration and management features will be available in a future update.</p>
      </div>
    </div>
  </main>
  
  <script src="dashboard.js?v=3"></script>
</body>
</html>